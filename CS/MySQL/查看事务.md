
查看 InnoDB 事务的实时信息
```SQL
SELECT * FROM information_schema.INNODB_TRX;
```

`information_schema.INNODB_TRX` 表提供了 InnoDB 事务的实时信息，以下是该表中各字段的含义：

### 基本事务信息

- ​**​trx_id​**​：事务的唯一标识符，InnoDB 内部生成，用于唯一标识每个事务。只读事务或未申请锁的事务不会分配此 ID。例如，值为 '120706744' 或 '421259478658352' 的不同事务 ID 可区分不同事务。
- ​**​trx_state​**​：当前事务的状态，常见取值及含义如下：
    - ​**​RUNNING​**​：事务正在执行中，没有等待锁。
    - ​**​LOCK WAIT​**​：事务正在等待锁。
    - ​**​ROLLING BACK​**​：事务正在回滚。
    - ​**​COMMITTING​**​：事务正在提交。
- ​**​trx_started​**​：事务开始的时间，格式如 '2025-03-27 15:28:51'，可用于判断事务运行的时长。
- ​**​trx_requested_lock_id​**​：如果事务处于锁等待状态，此字段标识它正在等待的锁的 ID；若事务状态不是 'LOCK WAIT'，则该字段为空。可以通过该字段关联 `INNODB_LOCKS` 表的 `id` 字段获取更多锁的详细信息。
- ​**​trx_wait_started​**​：事务开始等待锁的时间，如果事务没有在等待锁，该值为空。

### 事务权重和资源使用

- ​**​trx_weight​**​：事务的权重，反映事务修改和锁定的行数（不一定是准确的数量）。在死锁时，InnoDB 会选择权重最小的事务作为牺牲品让其回滚。更改了非事务表的事务被认为比其他事务重，无论更改和锁定的行数是多少。
- ​**​trx_mysql_thread_id​**​：与事务关联的 MySQL 线程 ID，这些是 MySQL 进程列表中对应的线程 ID，可以用 `SHOW PROCESSLIST` 查看更多信息，也可以用 `KILL <thread_id>` 终止对应事务。
- ​**​trx_query​**​：事务当前正在执行的 SQL 语句，若事务当前没有正在执行的 SQL 语句，该字段为空，可能处于事务中的空闲状态。
- ​**​trx_operation_state​**​：事务的当前操作状态，例如可能显示 'executing' 或者 'fetching rows' 等，若没有特定操作状态则为空。

### 事务操作状态

- ​**​trx_tables_in_use​**​：事务当前正在使用的表的数量，若事务当前没有正在使用的表，该值可能为 0，这与事务没有正在执行的 SQL 语句一致。
- ​**​trx_tables_locked​**​：事务当前持有行锁的表的数量。因为这些是行锁，不是表锁，所以尽管某些行被锁定，这些表仍然可以被多个事务读写。
- ​**​trx_lock_structs​**​：事务持有的锁结构的数量，表明事务锁定了多个对象。
- ​**​trx_lock_memory_bytes​**​：事务的锁结构占用的内存字节数，系统会为每个事务预分配一定的锁内存。
- ​**​trx_rows_locked​**​：事务锁定的行数（估计值），该值可能包括物理上存在但对事务不可见的删除标记行。
- ​**​trx_rows_modified​**​：事务修改或插入的行数。

### 事务控制参数

- ​**​trx_concurrency_tickets​**​：事务的并发票据数，由系统变量 `innodb_concurrency_tickets` 设置，指示当前事务被换出前可以做的工作量。
- ​**​trx_isolation_level​**​：事务的隔离级别，如 'READ UNCOMMITTED'、'READ COMMITTED'、'REPEATABLE READ'、'SERIALIZABLE' 等。
- ​**​trx_unique_checks​**​：是否启用唯一性检查，取值为 1 或 0，1 表示启用，这是默认行为，例如在批量数据加载期间可能会关闭。
- ​**​trx_foreign_key_checks​**​：是否启用外键约束检查，取值为 1 或 0，1 表示启用，这也是默认行为，在批量数据加载期间可能会关闭。
- ​**​trx_last_foreign_key_error​**​：最后一次外键错误信息，如果没有错误，则为空。

### 其他信息

- ​**​trx_adaptive_hash_latched​**​：表示事务是否持有自适应哈希索引的锁，当自适应哈希索引搜索系统被分区时，单个事务不会锁定整个自适应哈希索引，该值由 `innodb_adaptive_hash_index_parts` 参数控制，默认设为 8。
- ​**​trx_adaptive_hash_timeout​**​：表示事务在自适应哈希索引锁存器上的等待超时时间。当没有自适应哈希索引争用时，该值保持为零，并且语句保留 latch 直到它们完成。在争用期间，它倒计时到零，并且语句在每行查找后立即释放 latch。
- ​**​trx_is_read_only​**​：标识事务是否为只读事务，取值为 1 代表只读事务，此时事务不能执行写操作。
- ​**​trx_autocommit_non_locking​**​：标识事务是否为自动提交的非锁定 SELECT 语句，取值为 1 表示是，若该字段和 `trx_is_read_only` 都为 1，InnoDB 会优化事务，以减少事务改变表数据的开销。

---
